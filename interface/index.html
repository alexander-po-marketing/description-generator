<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Description Generator Controller</title>
    <link rel="stylesheet" href="styles.css" />
</head>
<body>
    <header class="hero">
        <div>
            <p class="eyebrow">Interactive control panel</p>
            <h1>DrugBank → Pharmaoffer description pipeline</h1>
            <p class="lede">
                Configure OpenAI credentials, choose DrugBank XML sources, align output folders, and launch the generator.
            </p>
            <div class="hero-actions">
                <button type="button" id="refresh-files" class="ghost">Refresh file suggestions</button>
            </div>
        </div>
    </header>

    <main class="layout">
        <section class="card wide">
            <h2>Repository layout</h2>
            <p>Suggested folders for interactive runs:</p>
            <ul class="pill-list">
                <li><strong>inputs/</strong> – DrugBank XML, valid-drug ID lists</li>
                <li><strong>outputs/</strong> – <code>database.json</code>, <code>api_pages.json</code>, <code>api_pages_preview.html</code></li>
                <li><strong>logs/</strong> – prompt logs and pipeline logs</li>
                <li><strong>cache/</strong> – any scratch data created by experiments</li>
                <li><strong>scripts/</strong> – the local web server and helper utilities</li>
                <li><strong>interface/</strong> – this UI and its assets</li>
            </ul>
        </section>

        <section class="card">
            <h2>OpenAI credentials &amp; model settings</h2>
            <form id="credentials-form" class="stack">
                <div class="field-grid">
                    <label>API key
                        <input type="password" id="api-key" name="apiKey" autocomplete="off" placeholder="sk-..." />
                    </label>
                    <label>Organization ID
                        <input type="text" id="org-id" name="orgId" autocomplete="off" placeholder="Optional" />
                    </label>
                    <label>Project ID
                        <input type="text" id="project-id" name="projectId" autocomplete="off" placeholder="Optional" />
                    </label>
                </div>
                <div class="field-grid">
                    <label>Model
                        <input type="text" id="model" name="model" value="gpt-5.1-chat-latest" />
                    </label>
                    <label>Summary model
                        <input type="text" id="summary-model" name="summaryModel" value="gpt-5.1-chat-latest" />
                    </label>
                </div>
            </form>
        </section>

        <section class="card">
            <h2>Input &amp; output locations</h2>
            <form id="paths-form" class="stack">
                <div class="field-grid">
                    <label>DrugBank XML
                        <input type="text" id="xml-path" list="xml-suggestions" placeholder="drugbank.xml" value="drugbank.xml" />
                    </label>
                    <label>Database JSON output
                        <input type="text" id="database-path" list="json-suggestions" placeholder="database.json" value="database.json" />
                    </label>
                </div>
                <div class="field-grid">
                    <label>Page models JSON output
                        <input type="text" id="page-models-json" list="json-suggestions" placeholder="api_pages.json" value="api_pages.json" />
                    </label>
                    <label>Import-ready JSON output
                        <input type="text" id="import-json" list="json-suggestions" placeholder="api_pages_import.json" value="api_pages_import.json" />
                    </label>
                </div>
                <datalist id="xml-suggestions"></datalist>
                <datalist id="json-suggestions"></datalist>
                <p class="hint">Preview HTML and prompt logs are written to their default locations automatically.</p>
            </form>
        </section>

        <section class="card">
            <h2>Pipeline options</h2>
            <form id="options-form" class="stack">
                <div class="field-grid">
                    <label>Valid DrugBank IDs (comma-separated)
                        <input type="text" id="valid-ids" placeholder="DB0001, DB0002"/>
                    </label>
                    <label>Valid IDs file
                        <input type="text" id="valid-ids-file" list="text-suggestions" placeholder="valid_ids.txt" value="valid_ids.txt" />
                    </label>
                    <label>Max drugs
                        <input type="number" id="max-drugs" min="1" placeholder="Optional" />
                    </label>
                </div>
                <div class="field-grid">
                    <label>Log level
                        <select id="log-level">
                            <option value="DEBUG">DEBUG</option>
                            <option value="INFO" selected>INFO</option>
                            <option value="WARNING">WARNING</option>
                            <option value="ERROR">ERROR</option>
                        </select>
                    </label>
                    <label class="checkbox">
                        <input type="checkbox" id="overwrite" /> Allow overwriting existing outputs
                    </label>
                    <label class="checkbox">
                        <input type="checkbox" id="continue" /> Continue if outputs already exist
                    </label>
                </div>
                <datalist id="text-suggestions"></datalist>
            </form>
        </section>

        <section class="card wide">
            <div class="toolbar">
                <div>
                    <h2>Visual template builder</h2>
                    <p class="hint">
                        Toggle blocks, rename headings, control array limits, and reorder sections before they are written to
                        <code>api_pages.json</code>.
                    </p>
                </div>
                <div class="toolbar-actions">
                    <button id="open-template-modal" type="button" class="primary">Edit template</button>
                    <button id="reset-template" type="button" class="ghost">Reset to default template</button>
                </div>
            </div>
            <p class="hint">The template editor opens in a modal so it stays out of the way until needed.</p>
        </section>

        <section class="card wide">
            <div class="toolbar">
                <div>
                    <h2>Run generator</h2>
                    <p class="hint">Settings above are serialized into a single request to the local server.</p>
                </div>
                <div class="toolbar-actions">
                    <button id="open-preview" type="button" class="ghost">Open preview HTML</button>
                    <button id="build-sections" type="button" class="ghost">Build section HTML</button>
                    <button id="run-button" class="primary">Run pipeline</button>
                </div>
            </div>
            <pre id="status" class="status" aria-live="polite">Waiting to start…</pre>
        </section>
    </main>

    <template id="status-template">
        <div class="status-block">
            <p class="status-header"></p>
            <pre class="status-body"></pre>
        </div>
    </template>

    <div id="template-modal" class="modal" aria-hidden="true" role="dialog" aria-label="Template editor">
        <div class="modal-surface">
            <div class="modal-header">
                <div>
                    <p class="eyebrow">Template editor</p>
                    <h3>Configure API page blocks</h3>
                </div>
                <button type="button" id="close-template-modal" class="ghost">Close</button>
            </div>
            <div class="modal-body">
                <div class="template-builder" id="template-builder" aria-live="polite"></div>
                <details class="template-preview">
                    <summary>Template definition JSON</summary>
                    <pre id="template-preview"></pre>
                </details>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
